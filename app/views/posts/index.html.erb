<div id="map"></div>

<div class="ui doubling four link cards">
  <% @posts.each do |post| %>
    <div class="card">
      <div class="image">
        <%= image_tag post.photo %>
      </div>
      <div class="content">
        <div class="description">
          hahaha test
        </div>
      </div>
      <div class="extra content">
        extra
      </div>
    </div>
  <% end %>
</div>

<script type="text/javascript">
    let map = new GMaps({
        div: '#map',
        lat: 35.6896,
        lng: 139.6921,
    });

    GMaps.geolocate({
        success: function (position) {
            map.setCenter(position.coords.latitude, position.coords.longitude);
        },
        error: function (error) {
        },
        not_supported: function () {
        },
    });

    let markers = <%= @markers.to_json.to_s.html_safe %>;
    markers.forEach(function(marker) {
        map.addMarker({
            lat: marker.lat,
            lng: marker.lng,
            infoWindow: {
                content: `<img src=${marker.photo_url} height='100' />`
            },
            mouseover: function (e) {
                this.infoWindow.open(map, this);
            },
            mouseout: function (e) {
                this.infoWindow.close();
            },
            click: function (e) {
                window.location.href = `/posts/${marker.post_id}`
            }
        })
    });
</script>
